@startuml QuanLyDiemSinhVien

' === ABSTRACT CLASSES ===
abstract class Person {
    #ma: String
    #hoTen: String
    #ngaySinh: LocalDate
    #email: String
    #soDienThoai: String
    +{abstract} layThongTinChiTiet(): String
    +{abstract} layLoaiNguoi(): String
}

abstract class DanhGia {
    #maDanhGia: String
    #tenDanhGia: String
    #diem: double
    #moTa: String
    +{abstract} tinhTrongSo(): double
    +{abstract} layLoaiDanhGia(): String
    +tinhDiemCoTrongSo(): double
}

' === INTERFACES ===
interface LuuTru {
    +luuFile(): void
    +docFile(): void
}

interface XepHang {
    +tinhGPA(): double
    +xepLoaiHocLuc(): String
}

' === MODEL CLASSES - NGUOI ===
class SinhVien {
    -lopHoc: LopHoc
    -khoa: Khoa
    -danhSachMaDiem: List<String>
    -gpa: double
    -xepLoai: String
    +tinhGPA(): double
    +xepLoaiHocLuc(): String
    +themMaDiem(maDiem: String): void
}

class GiangVien {
    -khoa: Khoa
    -chucVu: String
    -hocVi: String
    -danhSachMaHocPhan: List<String>
    +themHocPhan(maHocPhan: String): void
}

' === MODEL CLASSES - DANHGIA ===
class BaiKiemTra {
    -trongSo: double
    -thoiGian: int
    +tinhTrongSo(): double
}

class ThiGiuaKy {
    -trongSo: double
    -phongThi: String
    -thoiGian: int
    +tinhTrongSo(): double
}

class ThiCuoiKy {
    -trongSo: double
    -phongThi: String
    -thoiGian: int
    -batBuoc: boolean
    +tinhTrongSo(): double
}

class BaiTapLon {
    -trongSo: double
    -ngayNop: LocalDate
    -nopTreHan: boolean
    -soThanhVienNhom: int
    +tinhTrongSo(): double
}

' === MODEL CLASSES - HOCPHAN ===
class HocPhan {
    -maHocPhan: String
    -tenHocPhan: String
    -soTinChi: int
    -giangVien: GiangVien
    -trongSoQuiz: double
    -trongSoGiuaKy: double
    -trongSoCuoiKy: double
    -trongSoBaiTap: double
    +tinhDiemTongKet(...): double
}

class Diem {
    -maDiem: String
    -sinhVien: SinhVien
    -hocPhan: HocPhan
    -diemQuiz: double
    -diemGiuaKy: double
    -diemCuoiKy: double
    -diemBaiTap: double
    -diemTongKet: double
    -diemChu: String
    -daDat: boolean
    +capNhatDiemQuiz(diem: double): void
    +tinhDiemTongKet(): void
    +{static} kiemTraDiem(diem: double): void
}

' === MODEL CLASSES - TOCHUC ===
class Khoa {
    -maKhoa: String
    -tenKhoa: String
    -truongKhoa: String
    -dienThoai: String
}

class LopHoc {
    -maLop: String
    -tenLop: String
    -khoa: Khoa
    -namNhapHoc: int
    -giaoVienChuNhiem: String
}

' === EXCEPTION CLASSES ===
class DiemKhongHopLeException {
}

class KhongTimThaySinhVienException {
}

class KhongTimThayHocPhanException {
}

' === REPOSITORY CLASSES ===
class KhoaRepository {
    -danhSachKhoa: List<Khoa>
    +them(khoa: Khoa): void
    +capNhat(khoa: Khoa): void
    +xoa(maKhoa: String): void
    +timTheoMa(maKhoa: String): Optional<Khoa>
}

class SinhVienRepository {
    -danhSachSinhVien: List<SinhVien>
    +them(sv: SinhVien): void
    +timTheoMa(maSV: String): Optional<SinhVien>
    +timKiemMo(searchTerm: String): List<SinhVien>
}

class DiemRepository {
    -danhSachDiem: List<Diem>
    +them(diem: Diem): void
    +timTheoSinhVien(maSV: String): List<Diem>
    +validateTatCaDiem(): boolean
}

' === SERVICE CLASSES ===
class TinhDiemService {
    +tinhDiemTongKet(diem: Diem): void
    +tinhGPA(sv: SinhVien, dsDiem: List<Diem>): double
    +tinhGPAChoTatCaSinhVien(...): void
}

class XepLoaiService {
    +NGUONG_XUAT_SAC: double
    +NGUONG_GIOI: double
    +NGUONG_KHA: double
    +NGUONG_TRUNG_BINH: double
    +xepLoaiHocLuc(gpa: double): String
    +xepLoaiHocLucChoSinhVien(sv: SinhVien): String
}

class BangXepHangService {
    +xepHangToanTruong(...): List<SinhVien>
    +xepHangTheoKhoa(...): List<SinhVien>
    +xepHangTheoLop(...): List<SinhVien>
    +locTheoGPAToiThieu(...): List<SinhVien>
    +taoBangXepHang(...): String
}

class ThongKeService {
    +thongKeTyLeXepLoai(...): Map<String, Double>
    +danhSachHocLai(...): List<Entry>
    +taoHistogramPhanBoDiem(...): String
    +taoHistogramTheoHocPhan(...): String
    +taoBaoCaoTongHop(...): String
}

' === RELATIONSHIPS ===

' Inheritance
Person <|-- SinhVien
Person <|-- GiangVien
DanhGia <|-- BaiKiemTra
DanhGia <|-- ThiGiuaKy
DanhGia <|-- ThiCuoiKy
DanhGia <|-- BaiTapLon
Exception <|-- DiemKhongHopLeException
Exception <|-- KhongTimThaySinhVienException
Exception <|-- KhongTimThayHocPhanException

' Interface Implementation
SinhVien ..|> XepHang
KhoaRepository ..|> LuuTru
SinhVienRepository ..|> LuuTru
DiemRepository ..|> LuuTru

' Associations
SinhVien "1" --> "1" LopHoc
SinhVien "1" --> "1" Khoa
LopHoc "1" --> "1" Khoa
GiangVien "1" --> "1" Khoa
HocPhan "1" --> "1" GiangVien

Diem "1" --> "1" SinhVien
Diem "1" --> "1" HocPhan

' Repository Associations
KhoaRepository "1" o-- "*" Khoa
SinhVienRepository "1" o-- "*" SinhVien
DiemRepository "1" o-- "*" Diem

' Service Dependencies
TinhDiemService ..> Diem
TinhDiemService ..> SinhVien
XepLoaiService ..> SinhVien
BangXepHangService ..> TinhDiemService
BangXepHangService ..> XepLoaiService
ThongKeService ..> XepLoaiService

@enduml

